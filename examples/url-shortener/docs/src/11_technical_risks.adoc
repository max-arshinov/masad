ifndef::imagesdir[:imagesdir: ../images]

[[section-technical-risks]]
== Risks and Technical Debts

This section summarizes key technical risks and debts for the URL shortener, with focus on the stated quality goals (≤0.2s redirect latency; ≤0.1s additional latency under two-node failure; ~100M new links/year; 3-year retention) and related constraints (click stats handled by a third-party service).

[cols="2,1,1,3" options="header"]
|===
|Risk |Impact |Likelihood |Mitigations / Notes

|Higher-than-expected slug collisions or unique-index contention (ADR 0002: random Base62, length 7)
|Write retries, elevated create latency, rare 409/5xx on create under surge
|Low
|Use CSPRNG only; retry on unique constraint violation; alert when retry rate >0.05%; feature-flag to length 8; load test with insert storms before releases.

|Case sensitivity lost in routing/proxies (slugs are case-sensitive Base62)
|404s or incorrect redirects in certain paths or behind caches/CDNs
|Medium
|Ensure end-to-end case-sensitive routing (framework, proxy, CDN); add contract tests through full stack; forbid automatic lowercasing/normalization.

|Weak or misused RNG (predictable slugs)
|Enumeration/abuse; brand/reputation risk
|Low
|Use OS CSPRNG or vetted library (e.g., NanoID); forbid time/seeded PRNGs; startup self-check; pin versions; security review of slug generator changes.

|Abuse: phishing/malware links and enumeration
|Domain blacklisting; legal/compliance issues; user harm
|Medium–High
|Rate limits; CAPTCHA/turnstile for anonymous users; link scanning and blocklists; takedown workflow; per-user quotas; anomaly detection.

|Third-party analytics dependency outage/backpressure
|Lost events or slower redirects if coupled incorrectly
|Medium
|Keep redirects independent; enqueue events asynchronously with bounded buffers and drop policies; circuit-break analytics on outage; monitor vendor SLAs.

|Multi-region write consistency and global uniqueness
|Duplicate slugs or conflicting writes; data corruption
|Medium
|Prefer globally consistent DB with unique index; else single write-region; or add opaque region/namespace prefixes; require idempotency keys; run conflict drills.

|Latency SLO breaches due to cold caches or DB slowness
|Redirect >0.2s p95/p99; SLO violations
|Medium
|Edge/CDN caching; in-memory cache with TTL; cache stampede protection (stale-while-revalidate); DB performance SLOs and alerts; warm popular keys.

|Reserved words/denylist gaps (e.g., /api, /admin, offensive terms)
|Route conflicts; reputational issues
|Medium
|Maintain denylist; regenerate on hit; versioned config; small unit tests and runtime metrics for denylist hits; allow emergency updates.

|Custom alias conflicts/squatting
|User friction; support load
|Medium
|Unique index on slug; reservation rules; moderation/admin override; trademark word list; appeal workflow.

|Length migration risk (7→8) and validators
|Creation fails or reads 404 during rollout
|Low–Medium
|Accept both lengths in routers/validators; feature flags; canary and staged rollout; explicit tests; dashboards watching retry/length distribution.

|Storage growth and cost (3-year retention, high volume)
|Rising cost; slower backups/maintenance
|Medium
|Right-size columns and indexes; partitioning; compression; lifecycle policies (archival/TTL if policy allows); backup/restore tests.

|Supply-chain vulnerabilities (slug libs, frameworks)
|Security incidents, unexpected behavior
|Medium
|Pin and periodically update deps; SCA scanning; SBOM; mirror/vendor critical libs; review changes to slug generator path.

|Observability gaps (metrics, tracing, alerting)
|Incident detection too slow; MTTR high
|Medium
|Define SLOs: create/redirect latency and error budgets; instrument retry rates, denylist hits; red/black dashboards; runbooks; synthetic checks.

|Operational load from hotspots on extremely popular slugs
|Cache stampede; backend pressure
|Medium
|Aggressive edge caching; request coalescing; short TTLs with SWR; per-key rate limiting; autoscaling.

|URL validation and SSRF in scanners (if link scanning fetches targets)
|Internal resource exposure; outages
|Low–Medium
|Block private networks and link-local ranges; DNS+IP verification; timeouts and size limits; fetch via isolated egress.

|Backups/restores causing duplicate slugs on replay
|Create conflicts; partial data loss
|Low
|Practice restore into staging; verify unique index; idempotent ingest tools; post-restore integrity checks.
|===

=== Technical Debts

- No canonicalization/dedup on create (same long URL may map to multiple slugs). Increases storage; acceptable trade-off; can add canonical hash pre-check later.
- No quarantine policy on delete/expire yet; risk of confusing slug reuse if reclaiming keys. Define policy before enabling delete/reuse.
- Limited end-to-end tests for case sensitivity and length migration; expand tests through proxy/CDN/app layers.
- Denylist management is config-based without an admin UI; operational friction. Consider an auditable admin workflow if needed.
- Multi-region design choices (single-writer vs global index) not finalized here; must be decided before scaling globally.
