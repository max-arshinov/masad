openapi: 3.0.3
info:
  title: URL Shortener API
  version: 1.0.0
  description: Public redirect and management API for creating and maintaining short URLs.
servers:
  - url: https://api.example.com
    description: Production API server
security:
  - bearerAuth: []
paths:
  "/{code}":
    get:
      summary: Redirect by short code
      description: Returns a 302 redirect to the target URL. Public endpoint without auth.
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
      responses:
        "302":
          description: Found. Redirect to target URL via Location header.
          headers:
            Location:
              description: Target URL
              schema:
                type: string
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
  "/v1/urls":
    post:
      summary: Create a short URL
      description: Creates a short URL mapping. Uses Idempotency-Key for safe retries.
      parameters:
        - name: Idempotency-Key
          in: header
          required: false
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UrlCreateRequest'
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UrlResponse'
        "400":
          description: Bad Request
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
        "401":
          description: Unauthorized
        "409":
          description: Conflict (custom code taken)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
  "/v1/urls/{code}":
    get:
      summary: Get URL metadata
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UrlResponse'
        "401":
          description: Unauthorized
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
    delete:
      summary: Delete a short URL
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: No Content
        "401":
          description: Unauthorized
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
  "/v1/urls/{code}/stats":
    get:
      summary: Get aggregated stats for a short URL
      parameters:
        - name: code
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UrlStats'
        "401":
          description: Unauthorized
        "404":
          description: Not Found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/ProblemDetails'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    UrlCreateRequest:
      type: object
      required: [target_url]
      properties:
        target_url:
          type: string
          format: uri
        custom_code:
          type: string
          description: Optional custom short code
        expires_at:
          type: string
          format: date-time
          description: Optional explicit expiration; defaults to 3 years
    UrlResponse:
      type: object
      properties:
        short_code:
          type: string
        short_url:
          type: string
          format: uri
        target_url:
          type: string
          format: uri
        created_at:
          type: string
          format: date-time
        expires_at:
          type: string
          format: date-time
    UrlStats:
      type: object
      properties:
        total_clicks:
          type: integer
          format: int64
        last_24h_clicks:
          type: integer
          format: int64
        last_click_at:
          type: string
          format: date-time
    ProblemDetails:
      type: object
      properties:
        type:
          type: string
          format: uri
        title:
          type: string
        status:
          type: integer
        detail:
          type: string
        instance:
          type: string

