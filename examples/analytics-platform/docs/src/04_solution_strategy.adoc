ifndef::imagesdir[:imagesdir: ../images]

[[section-solution-strategy]]
== Solution Strategy

=== Back-of-the-envelope sizing (assumptions)

- Event rate: ~100B events/day ≈ 1.16M events/s (S-1)
- Avg raw event size: 250–400 B (headers + payload); assume 300 B median
- Ingest bandwidth: ~350 MB/s raw across regions (peaks 2–3x on traffic spikes)
- Hot query horizon: ≤3 months for interactive charts (P-1); freshness 50–100 min (P-2)
- Compression: 4–8x on columnar/Parquet; 2–4x in streams

=== Storage sizing

- Daily raw: 100B × 300 B ≈ 30 TB/day
- Stream/log compressed: ~10–15 TB/day
- Columnar (Parquet/ORC) compressed: ~4–8 TB/day
- Yearly cold tier (compressed): ~1.5–3.0 PB/year; indefinite retention (R-1)
- Hot tier 30–90 days: ~120–720 TB compressed; requires partitioning + rollups

=== Stream and partitions

- Throughput target: ~350 MB/s; budget 2× headroom
- Rule-of-thumb 10–20 MB/s/partition → 32–64 partitions per high-traffic topic segment; consider 128–256 for bursts
- Consumer groups sized for ≥1.5× peak to drain backlogs within freshness SLO (P-2)

=== Query and latency budget (P-1)

- Scanning raw for 3 months is infeasible; use materialized rollups by time buckets and common dimensions
- P95 ≤1.5 s requires: warmed caches, small working sets (≤100–300M rows scanned), vectorized execution, predicate pushdown
- Pre-aggregation examples: per-tenant per-hour metrics; HLL for uniques; top-N sketches for referrers/UTM

=== Freshness (P-2)

- Micro-batch windows 5–15 min; end-to-end visibility 50–100 min with queuing and backfills
- Late events handling with watermarking; periodic rollup recompute to converge

=== Multitenancy and isolation

- Partition by tenant and time for storage and queries; quotas to prevent noisy neighbors
- Separate write/read planes; auto-scaling ingestion and query clusters independently

=== Cost guardrails (order-of-magnitude)

- Cold storage: 2 PB/year → mid five-figures/month on standard; reduce via IA/Glacier + compaction
- Hot store: hundreds of TB → plan for compression, TTL, and aggressive rollups
- Egress: dashboards within VPC; exports billed explicitly
