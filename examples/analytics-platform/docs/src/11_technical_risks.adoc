ifndef::imagesdir[:imagesdir: ../images]

[[section-technical-risks]]
== Risks and Technical Debts

See the https://docs.google.com/spreadsheets/d/1u34s6iZJaoJNX19yvFeGGZwvfviE3WZtB5ZpmMV9JK4/edit?gid=0#gid=0[spreadsheet] for the back-of-the-envelope calculations and risk assessment.

=== Context Recap (drivers)

- Target throughput: ~100B events/day (~1.16M/sec sustained), multi-tenant.
- Query latency: <= 1.5s for ad-hoc segmentation over up to 3 months of data.
- Ingestion-to-availability delay: 50–100 minutes acceptable.
- Retention: per-website data stored indefinitely (“forever”).

=== Top Risks

. Ingestion scalability and durability at peak load
* Description: Sustaining >1M events/sec with burstiness, while guaranteeing at-least-once delivery leads to back-pressure, hot partitions, and potential data loss.
* Consequences: Dropped/duplicated events, violated SLAs, costly over-provisioning.
* Mitigations:
** Use a durable, horizontally scalable log (e.g., Kafka/Pulsar) with correct partitioning and retention; plan for multi-AZ.
** Back-pressure and rate-limiting at SDK/edge; idempotent event keys for dedup downstream.
** Capacity modeling and load tests (sustained + burst >2x).

. Query latency on high-cardinality dimensions
* Description: Arbitrary filters (UTM, geo, device, browser, custom props) across 3 months can create cardinality explosions.
* Consequences: Slow queries, timeouts, or expensive compute.
* Mitigations:
** Choose storage optimized for time-series/OLAP with ingestion-time rollups and approximate sketches (HLL, TDigest) for uniques. See link:../../adrs/0002-choose-primary-analytics-database.md[ADR-0002].
** Tiered indexes/materialized views for common aggregations; query guards (limits) for pathological requests.

. Storage growth and long-term cost of “forever” retention
* Description: Petabyte-scale growth per tenant over years; cold vs hot access patterns vary.
* Consequences: Unbounded costs, compaction pressure, maintenance overhead.
* Mitigations:
** Hot/cold tiering with lifecycle policies; compression and columnar formats (Parquet/ORC); late compaction.
** Sampling or summarization for very old data; configurable per-tenant retention policies (legal exceptions handled).

. Data quality: duplicates, ordering, and schema evolution
* Description: At-least-once pipelines create duplicates; out-of-order late events and evolving schemas are inevitable.
* Consequences: Misreported metrics, broken dashboards, reprocessing cascades.
* Mitigations:
** Idempotency keys and windowed dedup; event-time watermarking; schema registry with compatibility rules; backfill tooling.

. Privacy, consent, and regulatory compliance (GDPR/CCPA)
* Description: Consent capture/propagation, right-to-erasure, and PII handling across hot/cold stores.
* Consequences: Regulatory risk, legal penalties, forced re-architecture.
* Mitigations:
** Data classification/PII minimization; per-tenant consent flags in event schema; deletion markers and erasure jobs across all tiers; audit logs.

. Multi-tenant isolation and noisy neighbors
* Description: One tenant’s spikes impact others in shared ingestion, storage, or compute.
* Consequences: SLO breaches, throttling, and fairness issues.
* Mitigations:
** Quotas, per-tenant partitions/pools, and rate limits; workload isolation (e.g., separate consumer groups/warehouses); cost budgets and alerts.

. Client SDK performance and integrity
* Description: SDKs can add latency to page loads, be blocked by ad blockers, or be misused.
* Consequences: Lower event capture rate, user experience impact.
* Mitigations:
** Async/Deferred loading; batching; retry with jitter; CDN endpoints that evade overzealous blockers; server-side tracking fallbacks.

. Operability/observability
* Description: Limited visibility into lag, drops, and query performance.
* Consequences: Slow incident response, hidden SLO drift.
* Mitigations:
** End-to-end SLOs and golden signals (ingest rate, lag, dedup rate, query P95/P99); traceability from SDK to report; chaos and DR drills.

. Vendor lock-in and portability
* Description: Tight coupling to a single cloud OLAP/queue makes exit costly.
* Consequences: Pricing shock, feature constraints.
* Mitigations:
** Open formats (Parquet), decoupled interfaces, abstraction layers; portability tests; multi-cloud design only if justified by ROI.

=== Assumptions and Unknowns

- The referenced spreadsheet might require access; risks above are derived from documented goals and common analytics-platform patterns.
- Detailed traffic shape, event schema, and tenancy model to be confirmed to refine likelihood/severity.
